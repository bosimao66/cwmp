# 写程序之前

cwmp（cpe wan 管理协议），也即tr069协议，由Broadband Forum组织在2004年制定，现在本工程希望实现这个协议。[协议相关文档](https://wiki.broadband-forum.org/display/RESOURCES)，搜索NUMBER = TR-069。

## 文档内容
现在参考的文档，是2004年的`tr-069-1-0-0.pdf`，里有四大板块，编程思想实现cwmp，就需要参考这些内容。


- **介绍** 
  最终目的是实现acs（Auto-Configuration Server）服务器，对多个cpe（Customer Premises Equipment）客户端进行远程配置。

  例如，服务提供商”移动“，在碧桂园小区下发有很多个个路由器，移动想要远程批量下发配置，就可以使用此协议。有了该协议后，工作人员可以坐在空调房的办公室，敲敲计算机键盘，就可以实现配置的目的，而不用跑到外面去一个个手动配置了。

- **架构** 
从协议栈展开。
| 序协议栈| 
| :---: |  
| cpe/acs应用程序 | 
| 远程过程调用 (RPC)| 
| soap | 
| http 协议| 
| SSL/TLS | 
| TCP/IP | 
- **程序要求**
 按照协议栈展开，难点在 "RPC"、会话流程、soap的封装适配
- **附录** 
	- **A** RPC方法：远程调用
	- **B** CPE参数：大量参数，预订功能
	- **C** 签名凭证：安全相关
	- **D** WEB身份管理：安全相关
	- **E** 签名包格式：安全相关

## 代码实现的思路
用编程的思维来理解上述协议，分模块，在linux下用c语言搭建工程，后期可能要一直到VXworks系统

- **依赖接口**
	- **平台接口** 和操作系统有关，例如linux的socket编程，方便以后换平台，对代码的修改。
	- **外来接口** 引用他人的代码，做接口，比如MD5加密、RSA加密，移植官方或者大部分人引用的的代码。
	- **自编的接口** 与平台无关，与协议无关的接口，例如内存分配管理，调试信息打印等。
- **协议栈**（自下而上，网络七层或者四层模型）
	- **物理层** 略。
	- **网络层** 提供主机ip地址便可，一般构建网络是路由器的事情。
	- **传输层** 调用linux操作系统的接口函数，例如socket相关函数。
	- **SLL/TLS** 介于传输层和会话层之间，一般调用平台接口函数。
	- **会话层** HTTP协议，linux没有对应的接口函数，所以自己写，或者“参考”同行。基于http协议的会话过程，比较麻烦，是一个难点，有时候需要把抽象的ACE和CPE，给出具体化例子来理解。
	- **SOAP数据封装（表示层？）** 参考SOAP封装的内容（这是一个难点，也许要移植解析soap数据的代码）。
	- **RPC（应用层1）** Remote Procedure Call也即远程过程调用，文档附录里有介绍，apc和acs的调用方法有所不同。
	
- **ACS**
	- **功能封装** 常用的功能封装成接口给外部程序调用。
	- **命令行调试** 调试接口。
	- **响应** 对rpc的响应。
- **CPE**
	- **功能封装** 常用的功能封装成接口给外部程序调用。
	- **命令行调试** 调试接口（主动）。
	- **响应** 对rpc的响应（被动、自下而上）。

备注：acs扮演服务器角色，cpe扮演客户端角色，编译的时候，需要给这两个编译的结果。它们共用上述协议层栈，但是在功能封装、命令行调试以及响应，有各自的特性。

## 工程构建和编译
和平台的关联很大，在windows构建目录文件，用sourceInsight4编写c语言代码，用linux虚拟机编译，使用makefile文件实现自动化编译。

## 自我指导
- 力求优化效率、速度；先搭建框架；分模块，注重思路，代码要次之； 注释和说明，不怕字数多；
- 难点要明确，用多种途径解决，必要时先搁置，例如soap封装、会话流程、构建参数数据结构；
- ai助理：chatgpt3.5



